
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Quick Start Tutorial: Diving into data reduction &mdash; GPI Data Pipeline 1.3.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc_gpi.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="GPI Data Pipeline 1.3.0 documentation" href="../index.html" />
    <link rel="up" title="GPI Data Pipeline User’s Guide" href="index.html" />
    <link rel="next" title="Tutorial 2: Polarimetry data reduction" href="tutorial_pol.html" />
    <link rel="prev" title="Starting the GPI Data Pipeline" href="starting.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial_pol.html" title="Tutorial 2: Polarimetry data reduction"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="starting.html" title="Starting the GPI Data Pipeline"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">GPI Data Pipeline 1.3.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">GPI Data Pipeline User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/GPI_Logo_v2012.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quick Start Tutorial: Diving into data reduction</a><ul>
<li><a class="reference internal" href="#getting-the-sample-dataset-for-this-tutorial">Getting the Sample Dataset for this Tutorial</a></li>
<li><a class="reference internal" href="#the-gpi-pipeline-guis">The GPI Pipeline GUIs</a><ul>
<li><a class="reference internal" href="#the-launcher-window">The Launcher Window</a></li>
<li><a class="reference internal" href="#the-status-console">The Status Console</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exploring-the-sample-dataset-using-gpitv">Exploring the Sample Dataset using GPItv</a><ul>
<li><a class="reference internal" href="#description-and-preview">Description and preview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-pre-created-calibration-files-to-your-calibrations-directory">Adding pre-created Calibration Files to your Calibrations Directory</a></li>
<li><a class="reference internal" href="#general-reduction-method">General reduction method</a></li>
<li><a class="reference internal" href="#reduce-your-calibration-and-science-files">Reduce your calibration and Science files</a><ul>
<li><a class="reference internal" href="#darks">Darks</a></li>
<li><a class="reference internal" href="#wavelength-solution">Wavelength solution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reducing-your-science-data">Reducing your science data</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="starting.html"
                        title="previous chapter">Starting the GPI Data Pipeline</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial_pol.html"
                        title="next chapter">Tutorial 2: Polarimetry data reduction</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/usage/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="quick-start-tutorial-diving-into-data-reduction">
<span id="usage-quickstart"></span><h1>Quick Start Tutorial: Diving into data reduction<a class="headerlink" href="#quick-start-tutorial-diving-into-data-reduction" title="Permalink to this headline">¶</a></h1>
<p>This is a quick tutorial to help new users become familiar with the GPI pipeline. More detailed
documentation of the tools shown here can be found on subsequent pages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is important that the user follow the tutorial in the displayed order. Skipping steps will result in reduction errors (missing calibrations etc).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although there is also a <a class="reference internal" href="tutorial_pol.html#usage-quickstart-pol"><em>tutorial for polarimetry data</em></a>, we highly recommend the user completes this tutorial first as it covers some pipeline fundamentals and aspects of using the GUIs that are prerequisites for the polarimetry tutorial.</p>
</div>
<div class="section" id="getting-the-sample-dataset-for-this-tutorial">
<h2>Getting the Sample Dataset for this Tutorial<a class="headerlink" href="#getting-the-sample-dataset-for-this-tutorial" title="Permalink to this headline">¶</a></h2>
<p>As an introduction to reducing data with the GPI Pipeline, a simple set of data is available for download <a class="reference external" href="http://docs.planetimager.org/GettingStarted_tutorial_dataset">here</a> in the file <tt class="docutils literal"><span class="pre">gpi_spectral_tutorial.zip</span></tt>.  Unzip that to get the tutorial dataset directory.</p>
<p>This directory contains a small set of data to give an overview of the different types of image and how to process them. All the files are raw data coming from the detector and we will reduce them one at a time.
The target is HD 8049, a K2 star with a white dwarf companion; see <a class="reference external" href="http://adsabs.harvard.edu/abs/2013A%26A...554A..21Z">Zurlo et al. 2013</a>.</p>
</div>
<div class="section" id="the-gpi-pipeline-guis">
<h2>The GPI Pipeline GUIs<a class="headerlink" href="#the-gpi-pipeline-guis" title="Permalink to this headline">¶</a></h2>
<p>It is assumed you have successfully launched the pipeline following the previous sections.(If not, see the <a class="reference internal" href="../installation/index.html#installation"><em>GPI Data Pipeline Installation &amp; Configuration</em></a> manual.) Therefore, you should have the two IDL sessions opened with the GPI launcher GUI and the GPI DRP status console below.
See <a class="reference internal" href="../installation/startup.html#first-startup"><em>Starting the GPI Data Pipeline</em></a> for details.</p>
<p>The GPI pipeline console should indicate something like:</p>
<div class="highlight-python"><div class="highlight"><pre>|    Now polling for DRF files in /Users/yourusername/somedirectory/GPI/queue/
</pre></div>
</div>
<div class="section" id="the-launcher-window">
<h3>The Launcher Window<a class="headerlink" href="#the-launcher-window" title="Permalink to this headline">¶</a></h3>
<p>The Launcher is a little menu window that acts as the starting point for launching other tools.
In this getting started tutorial, we will mostly use <a class="reference internal" href="../gpitv/index.html#gpitv"><em>GPItv</em></a> and the <a class="reference internal" href="recipe_editor.html#recipe-editor"><em>Recipe Editor</em></a> tools.</p>
<a class="reference internal image-reference" href="../_images/GPI-launcher1.png"><img alt="../_images/GPI-launcher1.png" class="align-center" src="../_images/GPI-launcher1.png" style="width: 174.0px; height: 226.0px;" /></a>
</div>
<div class="section" id="the-status-console">
<h3>The Status Console<a class="headerlink" href="#the-status-console" title="Permalink to this headline">¶</a></h3>
<p>This lets you see the current execution status, view log messages, and control certain aspects of the pipeline.
See <a class="reference internal" href="status_console.html#status-console"><em>Status Console</em></a> for more details.</p>
<a class="reference internal image-reference" href="../_images/GPI-DRP-Status-Console2.png"><img alt="../_images/GPI-DRP-Status-Console2.png" class="align-center" src="../_images/GPI-DRP-Status-Console2.png" style="width: 390.75px; height: 368.25px;" /></a>
</div>
</div>
<div class="section" id="exploring-the-sample-dataset-using-gpitv">
<h2>Exploring the Sample Dataset using GPItv<a class="headerlink" href="#exploring-the-sample-dataset-using-gpitv" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="../_images/GPI-TV-steps.png"><img alt="../_images/GPI-TV-steps.png" class="align-center" src="../_images/GPI-TV-steps.png" style="width: 676.5px; height: 507.75px;" /></a>
<p>Before reducing any files, the best is probably to take a look at the raw data we have using GPItv.
Click on the GPItv button on the GPI launcher to open it:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Then <strong>File-&gt;Browse Files...</strong>,</li>
<li>In the new window push the button <strong>Change...</strong> and select a folder in the <strong>GettingStarted_tutorial_dataset</strong>.</li>
<li>The <strong>.fits</strong> files list should appear.</li>
<li>As you select one file or another, the GPItv window should refresh and plot the new image.</li>
<li>Use the GPItv menu <strong>File-&gt;View FITS headers...</strong> to get detailed information for each image.</li>
<li>Click on the image to center the view on a pixel. Adapt the zoom with the buttons.</li>
</ol>
</div></blockquote>
<p>Feel free to experiment with the GPItv GUI and try out different functions. Most concepts should be straightforward to anyone familiar with <a class="reference external" href="http://hea-www.harvard.edu/RD/ds9/site/Home.html">ds9</a> or especially <a class="reference external" href="http://hea-www.harvard.edu/RD/ds9/site/Home.html">atv</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Details into GPItv functionality and operations can be found as part of the <a class="reference internal" href="../gpitv/index.html#gpitv"><em>GPItv</em></a> section of the documentation.</p>
</div>
<div class="section" id="description-and-preview">
<h3>Description and preview<a class="headerlink" href="#description-and-preview" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The two folders called <strong>darks_60s</strong> and <strong>darks_120s</strong> contain darks images with different integration times (respectively 58.19 and 119.29 seconds <a class="footnote-reference" href="#footnote1" id="id1">[1]</a> ). An example of a raw dark image is shown below. We can see horizontal stripes caused by correlated noise introduced during the detector readout. They will be removed by the pipeline.</li>
</ul>
<a class="reference internal image-reference" href="../_images/dark.png"><img alt="../_images/dark.png" class="align-center" src="../_images/dark.png" style="width: 283.0px; height: 282.0px;" /></a>
<ul class="simple">
<li>The <strong>wavelength_cal</strong> folder contains Xenon arc lamp calibration data. An example image is shown below. These images are much more interesting because you can observe particular wavelength positions for the lenslets. These data are used to calibrate the wavelength solution for each of the different lenslets.  Given the orientations of IFS spectral prism and detector, shorter wavelengths are closer to the top of the detector for each lenslet (i.e. have higher Y pixel values) while longer wavelengths extend down toward the bottom.</li>
</ul>
<a class="reference internal image-reference" href="../_images/Xe-lamp.png"><img alt="../_images/Xe-lamp.png" class="align-center" src="../_images/Xe-lamp.png" style="width: 125.0px; height: 123.5px;" /></a>
<ul class="simple">
<li>The <strong>onsky_data</strong> directory contains a raw coronagraphic image that we wish to reduce (the central section is shown below). Each microspectrum consists of the light from a 14.3 by 14.3 milli-arcsecond section of the field of view. The pipeline will extract each spectrum and create a 3 dimensional data cube, where each 2-dimensional slice of the cube corresponds to a given wavelength.</li>
</ul>
<a class="reference internal image-reference" href="../_images/science.png"><img alt="../_images/science.png" class="align-center" src="../_images/science.png" style="width: 212.0px; height: 204.5px;" /></a>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="footnote1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The reason for these odd exposure times is that GPI IFS exposures are quantized in units of the readout time for the detector, 1.45479 seconds. Because of this quantization, in practice one typically just rounds the durations, so these would be e.g. &#8220;60&#8221; and &#8220;120&#8221; second exposures - there&#8217;s no need to carry around all the significant figures.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="adding-pre-created-calibration-files-to-your-calibrations-directory">
<h2>Adding pre-created Calibration Files to your Calibrations Directory<a class="headerlink" href="#adding-pre-created-calibration-files-to-your-calibrations-directory" title="Permalink to this headline">¶</a></h2>
<p>The <strong>files_to_go_into_calibrations_directory</strong> directory contains files that must be copied over into your <a class="reference internal" href="../installation/configuration.html#config-envvars"><em>calibrations directory</em></a>. By default this is the path <tt class="docutils literal"><span class="pre">$GPI_REDUCED_DATA_DIR/calibrations</span></tt>.   Files in this directory include a bad pixel map, a microphonics model, and a flexure shifts lookup table.</p>
<p>After copying these files into the calibration directory, the user <em>must</em> click on <strong>Rescan Calib. DB</strong> button, located in the bottom left hand corner of the GPI DRP Status Console.  Whenever you manually put some file into (or remove a file from) the calibrations directory, you need to make the pipeline aware of this change.  The <strong>Rescan Calib. DB.</strong> function  will reindex all the FITS files in that directory and register any new files in the calibration file database. That enables the pipeline to find them during subsequent reductions.</p>
</div>
<div class="section" id="general-reduction-method">
<h2>General reduction method<a class="headerlink" href="#general-reduction-method" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s first discuss the general method to reduce any file. This will then be applied in the next sections for different particular cases. Only the selected items in the different option lists will change.</p>
<p>Press the <strong>Recipe Editor</strong> button in the GPI Launcher window and the window below will open.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The principle of the pipeline is based on recipes to reduce files. A recipe includes a list of input files (the ingredients) and a list of primitives to be applied on those files (the actions). Each primitive is an elementary algorithm to be applied on files listed in the recipe. The action can be anything, for instance subtract dark frame or build data cube. There are two kinds of primitives: ones that should be applied on each file and ones that are applied on all files together. For instance, <strong>Subtract Dark</strong> acts on one file at a time, while <strong>Combine 2D images</strong> will merge all the files from the list resulting in a single output file. The special primitive <strong>Accumulate Images</strong> divides the two categories of primitives.  All the primitives before are applied to each file, then Accumulate Images gathers up the results, and any primitives after are applied to the entire set.</p>
</div>
<a class="reference internal image-reference" href="../_images/recipe-editor-steps.png"><img alt="../_images/recipe-editor-steps.png" class="align-center" src="../_images/recipe-editor-steps.png" style="width: 676.5px; height: 507.75px;" /></a>
<p>The numbers of each of the following steps match with the screenshot above.</p>
<ol class="arabic simple">
<li>Press the upper-left button <strong>Add File(s)</strong> and select the files to reduce.</li>
<li>The selected files should appear just below.</li>
<li>Select the reduction type in the menu.</li>
<li>Select a Recipe Template. You may want to change the recipe if it doesn&#8217;t match exactly to your expectation. It is possible to add, move and remove any primitive and also to change various input parameters that adjust algorithm details. For any primitive that requires a Calibration file, this will automatically be chosen from the Calibration Database. The user can Manually select a calibration file by selecting the primitive and clicking the <strong>Choose Calibration File...</strong> button in the lower right hand corner.</li>
<li>Press <strong>Save Recipe and drop in queue</strong> button. This will generate the recipe based on the selected files and the list of primitives. The recipe is automatically saved in the queue directory, meaning that it will be read as soon as the pipeline is idle. The reduction might take a while depending on the computer.</li>
</ol>
<p>In the following, these steps will be repeated several times with specific indications.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For every reduction, a gpitv window will open with the result of the reduction and the file will be saved in the reduced files directory defined when installing the pipeline. If you don&#8217;t want to plot or to save the results, you can change the parameters <strong>Save</strong> and <strong>gpitv</strong> of the primitives.
To change parameters, select the primitive in the upper right table. Then, its parameters will appear in the bottom right table. Select the value of the parameter and type what ever is asked. Finally, press enter to validate the input.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The recipe templates assume a particular context and will only work on the proper type of input files, meaning that if you try to apply one of them to a random file it probably won&#8217;t work. In general, this should just result in the recipe being marked &#8216;Failed&#8217;, and the pipeline will return to awaiting the next recipe.  Feel free to experiment - the worst thing that should happen is you can get non-useful output files. It should be hard to actually crash the entire pipeline software stack, so if you do manage to do this somehow, you&#8217;ve probably found a bug which you can report.</p>
</div>
</div>
<div class="section" id="reduce-your-calibration-and-science-files">
<h2>Reduce your calibration and Science files<a class="headerlink" href="#reduce-your-calibration-and-science-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="darks">
<h3>Darks<a class="headerlink" href="#darks" title="Permalink to this headline">¶</a></h3>
<p>The dark calibration files for a given integration time can be combined using these amendments to the Recipe Editor usage steps above:</p>
<ul class="simple">
<li><strong>For step 1)</strong> Select the 60s darks using the Add File(s) button: <strong>S20131208S0016(-20).fits</strong></li>
<li><strong>For step 3)</strong> Change the reduction category to <strong>Calibration</strong></li>
<li><strong>For step 4)</strong> Select the <strong>Dark</strong> Recipe template from the dropdown menu</li>
</ul>
<p>The 60s darks correspond to the science data and will be used in the following section.</p>
<p>The selected primitives are then:</p>
<ul class="simple">
<li>Aggressive destripe (assuming there is no signal in the image): This should remove the apparent lines in the image that come from the readout of the pixels by the detector.</li>
<li>Accumulate Image: Gather all the images of the recipe. It indicates that the subsequent primitives will apply to all images.</li>
<li>Combine 2D dark images: Merge all the images with the same integration time using the median.</li>
</ul>
<p>The GPI DRP Status Console will display a progress bar and log messages while reducing the files.</p>
<p>When reducing calibration files the result is automatically saved in the Calibrations folder. By default, the path to this folder is <tt class="docutils literal"><span class="pre">$GPI_REDUCED_DATA/calibrations</span></tt> (note that one may have changed it manually using the <tt class="docutils literal"><span class="pre">$GPI_CALIBRATIONS_DIR</span></tt> system variable see <a class="reference internal" href="../installation/configuration.html#configuring"><em>Configuring the Pipeline</em></a> for details).</p>
<p>The pipeline will look for calibration files automatically by reading the text file <strong>GPI_Calibs_DB.txt</strong> in the calibration folder (see <a class="reference internal" href="calibdb.html#calibdb"><em>The Calibration Database</em></a>). There is a button at the bottom of the <strong>GPI DRP Status Console</strong> called <strong>Rescan Calib. DB</strong> to create or refresh this text file.</p>
<p>Use the button <strong>Remove All</strong> to remove all the selected files. then redo the above steps for the 120s integration times using files  <strong>S20131208S0021(-22).fits</strong>. This newly created dark frame will be used to reduce the wavelength calibrations in the next section.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">More information on the GPI dark frames and destriping can be found as part of the <a class="reference internal" href="../ifs/index.html#ifs-data-handbook"><em>GPI IFS Data Handbook</em></a>, under the <a class="reference internal" href="../ifs/steps/index.html#processing-step-by-step"><em>Processing GPI Data, Step by Step</em></a> in the Darks and Destriping sections.</p>
</div>
</div>
<div class="section" id="wavelength-solution">
<h3>Wavelength solution<a class="headerlink" href="#wavelength-solution" title="Permalink to this headline">¶</a></h3>
<p>Like the dark frames, the wavelength solution calibration files can be created using the Recipe Editor. However, the wavelength calibrations are computationally intensive and sensitive to their starting parameters. Therefore master wavelength calibrations are provided by Gemini and available for download at the <a class="reference external" href="http://www.gemini.edu/sciops/instruments/gpi/public-data">Gemini Public Data webpage</a>. What we recommend is to take a master wavelength calibration, then calculate the flexure offsets between the master and the arclamp snapshot image taken with your science.</p>
<p>For the purposes of this tutorial, we recommend users download the Wavecals.zip file available on the <a class="reference external" href="http://www.gemini.edu/sciops/instruments/gpi/public-data">Gemini Public Data webpage</a>. Then add the files to the calibration directory. The user must then update the calibration database by clicking the <strong>Rescan Calib. DB</strong> button, found in the lower left corner of the GPI DRP Status Console Window.</p>
<p>At this point, the user may (and probably should) skip to the next section, where the wavecals are discussed a little further down. However, should one wish to try to construct one on their own wavecales, follow the reduction steps below.</p>
<p>Note that his is a very computationally intensive reduction and it may take some time (&gt;15 minutes) to complete. It also requires a reference wavelength solution in the same band as the observed arc lamp data which is included in the Wavecals.zip file mentioned just above. Upon completion, it will ask if you would like to overwrite the file, for the purpose of this exercise one should rename the file so it can be recognized from the original (e.g. S20131208S0150_H_wavecal2.fits). An error will then pop up saying the wavelength calibration failed the quality check, this is due to lower signal-to-noise arc lamp images than what is used to derive the more recent wavecals. The quality of the solution is still adequate so you may save the image (which will put it in the calibrations directory) and continue.</p>
<ul class="simple">
<li><strong>For step 1)</strong> Select Xe-arc lamp files using the Add File(s) button: <strong>S20131208S0149(-151).fits</strong> (located in the wavelength_cal folder)</li>
<li><strong>For step 3)</strong> Keep selected the <strong>Calibration</strong> reduction category</li>
<li><strong>For step 4)</strong> Select the <strong>Wavelength Solution 2D</strong> Recipe template</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The wavelength calibration requires a complex algorithm. <a class="reference internal" href="../ifs/steps/wavelength_calibration.html#wavelength-calibration"><em>Wavelength Calibration</em></a> describes the process in more detail and provides examples of common errors with solutions.</p>
</div>
<p>A sample of the 2D image with the computed wavelength calibration is given below. In order to see how your wavelength solution compares with the data, one can open an image (e.g. S20131208S0150.fits) in GPItv (this is done either from the GPI Launcher or from just double clicking on the file name in the Recipe Editor). The user then selects their wavecal by selecting &#8220;Labels&#8221;-&gt;Select Wavecal/Polcal file, then selecting the desired wavelength calibration from the list. The user then selects &#8220;Labels&#8221; -&gt; Plot Wavcal/Polcal Grid. The green lines are the locations of the individual lenslet spectra. The coordinates of the lenslets are stored in a .fits file cube in the <strong>calibrations</strong> folder.</p>
<a class="reference internal image-reference" href="../_images/wavelength-solution.png"><img alt="../_images/wavelength-solution.png" class="align-center" src="../_images/wavelength-solution.png" style="width: 465.0px; height: 377.0px;" /></a>
</div>
</div>
<div class="section" id="reducing-your-science-data">
<h2>Reducing your science data<a class="headerlink" href="#reducing-your-science-data" title="Permalink to this headline">¶</a></h2>
<p>The following is an example of how to reduce science data. Start by creating a new recipe (File -&gt; New Recipe)</p>
<ul class="simple">
<li><strong>For step 1)</strong> Select your science data files from the onsky folder using the Add File(s) button <strong>S20131210S0025.fits</strong></li>
<li><strong>For step 3)</strong> Change the reduction category to <strong>SpectralScience</strong></li>
<li><strong>For step 4)</strong> Select the <strong>Quicklook Automatic Datacube Extraction</strong> Recipe template</li>
</ul>
<p>All the calibration files are automatically found and the result is a final data cube that should be plotted in GPItv at the end of the reduction. Note that the recipe may fail due to an inability to find the satellite spots. We&#8217;ll just ignore this for the time being. Feel free to look at the different wavelengths by changing the selected slice. Note that we have not yet accounted for the flexure offsets between the wavelength calibration derived above, and the current spectral positions, therefore the reduced cube will be rather ugly and have a large Moire pattern in the data.</p>
<a class="reference internal image-reference" href="../_images/bad_data_cube.png"><img alt="../_images/bad_data_cube.png" class="align-center" src="../_images/bad_data_cube.png" style="width: 258.5px; height: 249.0px;" /></a>
<p>In order to correct for this, we must account for the offsets. To do this in an approximate manner, one should open the raw image in GPItv (S20131210S0025.fits), then overplot the wavelength soluution (Labels -&gt; Get Wavecal from DB, then Labels -&gt; Plot Wavecal Grid -&gt; Draw Grid), one will see the large offets (shown below).</p>
<a class="reference internal image-reference" href="../_images/offset_wavecal.png"><img alt="../_images/offset_wavecal.png" class="align-center" src="../_images/offset_wavecal.png" style="width: 215.5px; height: 228.0px;" /></a>
<p>As a rough approximation, one can input offsets in GPItv (in the plot wavecal grid) until the overlap looks correct (note that old drawings of the wavecal can be erased by Labels -&gt; Erase All). An (X,Y) shift of (-2,1) is a reasonably good guess. The user can then input these offsets into the <a class="reference internal" href="primitives.html#updatespotshiftsforflexure"><em>Update Spot Shifts for Flexure</em></a> primitive. To do this:</p>
<ol class="arabic simple">
<li>Click on the <a class="reference internal" href="primitives.html#updatespotshiftsforflexure"><em>Update Spot Shifts for Flexure</em></a> primitive in the recipe window.</li>
<li>Change the method keyword to, &#8220;Manual&#8221; in the primitive parameters window (just below the recipe window)</li>
<li>Change the manual_dx and manual_dy keywords to the desired values.</li>
<li>Re-run the reduction (Save Recipe and Queue)</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Another more automated way to do this that is not described here utilises the &#8220;Move wavecal grid&#8221; Mouse Mode in GPItv.</p>
</div>
<p>Because a snapshot of the Argon arclamp was taken at the same telescope position, we can use this to determine the needed offsets in a much more robust fashion. So start a new recipe (File -&gt; New Recipe) and perform the following steps:</p>
<ul class="simple">
<li><strong>For step 1)</strong> Select the Ar-arc snapshot taken with the data (found in the onsky_data folder): <strong>S20131210S0055.fits</strong>.</li>
<li><strong>For step 3)</strong> Change the reduction category to <strong>Calibration</strong></li>
<li><strong>For step 4)</strong> Select the <strong>Quick Wavelength Solution</strong> Recipe template from the dropdown menu</li>
</ul>
<p>This primitive will use every 20th lenslet in the frame to calculate the net shift from the desired wavelength calibration. One must be careful to ensure the proper wavelength calibration is grabbed from the database (check the output in the pipeline xterm). If the wrong one is selected, then you can manually choose the correct one (S20131210S0055_H_wavecal.fits) using the Choose Calibration File button. A new wavecal (S20131210S0055_H_wavecal.fits) will then be added to the database, which is merely the old wavecal with new x-y spectral positions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Handling flexure with GPI data is an important aspect of GPI data reduction. The effects of flexure and how to deal with it are addressed in detail as part of the <a class="reference internal" href="../ifs/index.html#ifs-data-handbook"><em>GPI IFS Data Handbook</em></a>, under the <a class="reference internal" href="../ifs/steps/index.html#processing-step-by-step"><em>Processing GPI Data, Step by Step</em></a>. It is highly recommended that users should consult this guide prior to reducing their data.  The most robust approach observationally is to make sure that at least one arc lamp calibration exposure is taken contemporaneously with your science data, as in the case of the Ar snapshot for the dataset discussed here.  We hope to have improved automated algorithms for measuring flexure on science data ready by 2014B.</p>
</div>
<p>If you now repeat the reduction of the science data from above, the new wavecal will be captured and the datacube will appear as follows. Remember to set the <tt class="docutils literal"><span class="pre">method</span></tt> parameter in the <a class="reference internal" href="primitives.html#updatespotshiftsforflexure"><em>Update Spot Shifts for Flexure</em></a> primitive to <cite>none</cite> or <cite>Lookup</cite>.</p>
<a class="reference internal image-reference" href="../_images/data-cube.png"><img alt="../_images/data-cube.png" class="align-center" src="../_images/data-cube.png" style="width: 249.5px; height: 251.5px;" /></a>
<p><strong>Enjoy the first of many data cubes!</strong></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial_pol.html" title="Tutorial 2: Polarimetry data reduction"
             >next</a> |</li>
        <li class="right" >
          <a href="starting.html" title="Starting the GPI Data Pipeline"
             >previous</a> |</li>
        <li><a href="../index.html">GPI Data Pipeline 1.3.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >GPI Data Pipeline User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2014, Marshall Perrin, Jerome Maire &amp; the GPI Data Analysis Team.
      Last updated on Jun 18, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>