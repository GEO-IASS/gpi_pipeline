
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Bad Pixels &mdash; GPI Data Pipeline 1.3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc_gpi.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="GPI Data Pipeline 1.3.0 documentation" href="../../index.html" />
    <link rel="up" title="Processing GPI Data, Step by Step" href="index.html" />
    <link rel="next" title="Destriping and Microphonics" href="destriping_and_microphonics.html" />
    <link rel="prev" title="Thermal/Sky Backgrounds" href="thermal_background.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="destriping_and_microphonics.html" title="Destriping and Microphonics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="thermal_background.html" title="Thermal/Sky Backgrounds"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">GPI Data Pipeline 1.3.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >GPI IFS Data Handbook</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Processing GPI Data, Step by Step</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/GPI_Logo_v2012.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Bad Pixels</a><ul>
<li><a class="reference internal" href="#observed-effect-and-relevant-physics">Observed Effect and Relevant Physics:</a></li>
<li><a class="reference internal" href="#pipeline-processing">Pipeline Processing:</a></li>
<li><a class="reference internal" href="#creating-calibrations">Creating Calibrations:</a></li>
<li><a class="reference internal" href="#relevant-gpi-team-members">Relevant GPI team members</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="thermal_background.html"
                        title="previous chapter">Thermal/Sky Backgrounds</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="destriping_and_microphonics.html"
                        title="next chapter">Destriping and Microphonics</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/ifs/steps/badpixels.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="bad-pixels">
<span id="processing-step-by-step-badpixels"></span><h1>Bad Pixels<a class="headerlink" href="#bad-pixels" title="Permalink to this headline">¶</a></h1>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Further information may be found in <a class="reference external" href="http://arxiv.org/abs/1407.2302">Ingraham et al. 2014 &#8220;Gemini Planet Imager Observational Calibrations II:
Detector Performance and Characterization&#8221;</a></p>
</div>
<div class="section" id="observed-effect-and-relevant-physics">
<h2>Observed Effect and Relevant Physics:<a class="headerlink" href="#observed-effect-and-relevant-physics" title="Permalink to this headline">¶</a></h2>
<p>Detectors are not perfect. There are several ways in which pixels can be non-operable. &#8220;Cold&#8221; pixels have low or zero sensitivity to photons, while &#8220;Hot&#8221; pixels have anomalously high dark current. While all pixels become nonlinear near saturation, some pixels show nonlinear behavior at much lower count levels.</p>
</div>
<div class="section" id="pipeline-processing">
<h2>Pipeline Processing:<a class="headerlink" href="#pipeline-processing" title="Permalink to this headline">¶</a></h2>
<p>When processing science data, the GPI pipeline identifies bad pixels based on precomputed maps of their locations, and attempts to mitigate them by interpolating the values. Creating bad pixel maps is discussed below.</p>
<p>The repair of bad pixels is done using the primitive <a class="reference internal" href="../../usage/primitives.html#interpolatebadpixelsin2dframe"><em>Interpolate bad pixels in 2D frame</em></a>. You can configure that primitive to just flag the bad pixels as unusuable (marking them as NaN, and also flagging them as bad in the DQ extension), or to interpolate the values via one of several interpolation methods. We recommend using the 2 vertical neighboring pixels for the interpolation for spectral mode.</p>
<div class="figure align-center" style="width: 15cm">
<a class="reference internal image-reference" href="../../_images/badpix_interp_comparison.png"><img alt="alternate text" src="../../_images/badpix_interp_comparison.png" style="width: 330pt;" /></a>
<p class="caption">Comparison of different options for interpolating bad pixels. This plot was made by taking good pixels and applying the same interpolation methods, and evaluating how closely the interpolated values match the true value. Using the two vertical neighboring pixels works significantly better than using all 8 neighboring pixels. This is a consequence of the fact that the image is full of thousands of spectra dispersed in the vertical dimension. Pixels adjacent horizontally are offset in the cross-dispersion direction and won&#8217;t be that close in values for interpolation.</p>
</div>
</div>
<div class="section" id="creating-calibrations">
<h2>Creating Calibrations:<a class="headerlink" href="#creating-calibrations" title="Permalink to this headline">¶</a></h2>
<p><strong>Calibration DB File Type:</strong>  Bad pixel maps</p>
<p><strong>File Suffix:</strong> coldbadpix, hotpix, nonlinearbadpix, badpix</p>
<p><strong>Generate with Recipe:</strong>  Several. Generate Hot Bad Pixel Map from Darks, Generate Cold Bad Pixel Map from Flats, Combine Bad Pixel Maps</p>
<p>You&#8217;ll see there are 4 different types of files related to tracking bad pixels:</p>
<blockquote>
<div><ul class="simple">
<li>coldbadpix: Cold Bad Pixel Map</li>
<li>hotpix: Hot Pixel Map</li>
<li>nonlinearbadpix : Nonlinear Bad Pixel Map</li>
<li>badpix: Bad Pixel Map</li>
</ul>
</div></blockquote>
<p>The ones that are named &#8220;badpix&#8221; are the final output bad pixel maps. These
are generated from the union of one each Cold, Hot, and Nonlinear bad pixel maps. Thus,
to generate a bad pixel map you must first generate the
3 different individual maps, and then combine them.</p>
<p><strong>Step 1: Hot Bad Pixels</strong></p>
<p>Maps of hot (high dark current) pixels files can be generated in the pipeline using the &#8220;Generate Hot Bad Pixel Map
from Darks&#8221; recipe. The input files should be a set of &gt;= 10 dark exposures with identical ITIME,
preferably ITIME &gt; 100 s. (The longer the better...)</p>
<p>The algorithm works by measuring the read noise from the standard deviation between frames, and then
locating pixels that are very significantly above this level. Specifically, the criteria for being considered a hot pixel are &gt; 1 dark count e- per second, measured with &gt; 5 sigma confidence.  For comparison, typical pixels have dark counts &lt; 0.01 e-/sec for our detector.</p>
<p>The Data Parser, if ran on suitable dark files, will
automatically generate one recipe using the longest available dark sequence with &gt;= 10 files. (If the only darks available are &lt; 60 s in integration time, the Data Parser will not try to produce a hot pixel map.)</p>
<p><strong>Step 2: Cold Bad Pixels</strong></p>
<p>Maps of cold (non-photo-sensitive) pixels are generated using the recipe
&#8220;Generate Cold Bad Pixel Map from Flats&#8221; recipe. Finding such pixels for GPI is
more complicated than for typical instruments. Because of the lenslet array,
it&#8217;s not possible to illuminate the detector with any kind of truly flat
illumination pattern. You&#8217;ll always have the pattern of tens of thousands of
lenslets imprinted, with little to no illumination between them.  However, by
adding together many flat field exposures <em>taken using several different
filters</em> we can at least get illumination onto all of the pixels of the
detector.  (Though that illumination pattern is very structured rather than
flat.) We call this a &#8220;multi-filter pseudoflat&#8221;.  We then take advantage of
the translational symmetries inherent in the
lenslet array to build up a reference image that retains the spectral structure from the illumination pattern but
is smoothed over several detector pixels. By comparing individual pixels to this reference image, we can identify those that lack sensitivity.</p>
<p>The &#8220;cold pixel&#8221; selection criterion is  &#8220;any pixel with &lt; 15% normalized response measured from the summed multi-filter pseudoflat.&#8221;</p>
<p>The Data Parser will produce a recipe for this if given flat images in at least three different filters. (More is better)</p>
<p><strong>Step 3: Nonlinear Bad Pixels</strong></p>
<p>Every pixel shows some nonlinearity as it approaches saturation; that doesn&#8217;t count as bad.
But some pixels show <em>no</em> linear behavior at any exposure level (without being strictly hot or cold).
It&#8217;s those pixels we want to identify and exclude.</p>
<p>nonlinearbadpix are an <em>optional</em> calibration. The pipeline will work fine without them.
The required calibration file can only be generated outside of the pipeline right now, by a Python script by Marshall that
relies on looking at a flat image taken in UTR save-all-frames mode.</p>
<p><em>Because of this, right now the pipeline ignores the &#8220;only use calibrations from the same cooldown&#8221;
restriction for nonlinear bad pixel files - that one existing nonlinear bad pixel map can automatically be
used regardless of date.</em></p>
<p><strong>Step 4: Combining the above</strong></p>
<p>This part&#8217;s easy. Just run the &#8216;Combine Bad Pixel Maps&#8217; recipe. Feed it as
input data <em>any</em> raw GPI file. The contents of that file don&#8217;t actually matter, all that&#8217;s used is the date.
Based on that date, the data pipeline will
automatically retrieve the best available (closest in time) hot, cold, and (optionally) nonlinear bad pixel
maps from the calibration database, and produce a combined file that will be
saved into the calibration directory.</p>
<p>The Data Parser will produce a recipe for this if either the Hot Pixel or Cold Pixel recipes mentioned above are produced.</p>
</div>
<div class="section" id="relevant-gpi-team-members">
<h2>Relevant GPI team members<a class="headerlink" href="#relevant-gpi-team-members" title="Permalink to this headline">¶</a></h2>
<p>Marshall Perrin, Patrick Ingraham, Jeff Chilcote</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="destriping_and_microphonics.html" title="Destriping and Microphonics"
             >next</a> |</li>
        <li class="right" >
          <a href="thermal_background.html" title="Thermal/Sky Backgrounds"
             >previous</a> |</li>
        <li><a href="../../index.html">GPI Data Pipeline 1.3.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >GPI IFS Data Handbook</a> &raquo;</li>
          <li><a href="index.html" >Processing GPI Data, Step by Step</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2014, Marshall Perrin, Jerome Maire &amp; the GPI Data Analysis Team.
      Last updated on Jun 18, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>